generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model Convocatory {
  id        String     @id @default(auto()) @map("_id") @db.ObjectId
  from      DateTime   @db.Date
  to        DateTime   @db.Date
  year      Int
  name      String
  protocols Protocol[]
}

model Protocol {
  id            String           @id @default(auto()) @map("_id") @db.ObjectId
  createdAt     DateTime         @db.Date
  researcher    String           @db.ObjectId
  state         State            @default(DRAFT)
  reviews       Review[]
  sections      ProtocolSections
  convocatory   Convocatory      @relation(fields: [convocatoryId], references: [id])
  convocatoryId String           @db.ObjectId
}

model User {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  email     String   @unique
  lastLogin DateTime @db.Date
  name      String
  password  String
  role      Role     @default(RESEARCHER)
  Review    Review[]
}

model Review {
  id         String            @id @default(auto()) @map("_id") @db.ObjectId
  type       ReviewType
  comments   ReviewsComments[]
  reviewerId String            @db.ObjectId
  reviewer   User              @relation(fields: [reviewerId], references: [id])
  veredict   ReviewVeredict    @default(PENDING)
  protocolId String            @db.ObjectId
  protocol   Protocol          @relation(fields: [protocolId], references: [id])
}

type ProtocolSections {
  bibliography   ProtocolSectionsBibliography
  budget         ProtocolSectionsBudget
  description    ProtocolSectionsDescription
  duration       ProtocolSectionsDuration
  identification ProtocolSectionsIdentification
  introduction   ProtocolSectionsIntroduction
  methodology    ProtocolSectionsMethodology
  publication    ProtocolSectionsPublication
}

type ProtocolSectionsBibliography {
  chart ProtocolSectionsBibliographyChart[]
}

type ProtocolSectionsBibliographyChart {
  author String
  title  String
  year   Int
}

type ProtocolSectionsBudget {
  expenses ProtocolSectionsBudgetExpenses[]
}

type ProtocolSectionsBudgetExpenses {
  amount Float
  detail String
  type   String
  year   String
}

type ProtocolSectionsDescription {
  discipline String
  field      String
  line       String
  technical  String
  objective  String
  type       String
  words      String
}

type ProtocolSectionsDuration {
  chronogram ProtocolSectionsDurationChronogram[]
  duration   String
  modality   String
}

type ProtocolSectionsDurationChronogram {
  semester String
  task     String
}

type ProtocolSectionsIdentification {
  assignment String
  career     String
  sponsor    String[]
  team       ProtocolSectionsIdentificationTeam[]
  title      String
}

type ProtocolSectionsIdentificationTeam {
  hours     Float
  last_name String
  name      String
  role      String
}

type ProtocolSectionsIntroduction {
  justification String
  objectives    String
  problem       String
  state         String
}

type ProtocolSectionsMethodology {
  analysis       String
  considerations String
  design         String
  detail         String
  instruments    String
  participants   String
  place          String
  procedures     String
  type           String
}

type ProtocolSectionsPublication {
  title  String
  result String
}

type ReviewsComments {
  data String
  date DateTime @db.Date
}

enum ReviewType {
  METHODOLOGICAL
  SCIENTIFIC_INTERNAL
  SCIENTIFIC_EXTERNAL
}

enum ReviewVeredict {
  APPROVED
  REJECTED
  PENDING
}

enum Role {
  RESEARCHER
  SECRETARY
  METHODOLOGIST
  SCIENTIST
  ADMIN
}

enum State {
  NOT_CREATED
  DRAFT
  PUBLISHED
  METHODOLOGICAL_EVALUATION
  SCIENTIFIC_EVALUATION
  ACCEPTED
  ON_GOING
}
